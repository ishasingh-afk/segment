<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Details - Store</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <nav class="container">
      <div class="logo">Store</div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="products.html">Products</a></li>
        <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
        <li><a href="login.html">Login</a></li>
        <li><a href="debug.html">Debug</a></li>
      </ul>
      <div id="user-info" class="user-info"></div>
    </nav>
  </header>

  <main class="container">
    <section class="section" id="product-details">
      <!-- Product details will be populated by JavaScript -->
    </section>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2023 Store. All rights reserved.</p>
      <div>
        <a href="privacy.html">Privacy Policy</a>
      </div>
    </div>
  </footer>

  <script src="script.js"></script>
  <script>
    const products = {
      'SKU-001': { id: 'SKU-001', name: 'Tee', price: 19.99, brand: 'Brand', category: 'Clothing', description: 'Comfortable cotton tee with our logo printed on the front.' },
      'SKU-002': { id: 'SKU-002', name: 'Hoodie', price: 39.99, brand: 'Brand', category: 'Clothing', description: 'Cozy hoodie perfect for layering. Features a kangaroo pocket and adjustable hood.' },
      'SKU-003': { id: 'SKU-003', name: 'Mug', price: 9.99, brand: 'Brand', category: 'Accessories', description: 'Ceramic mug with our branding. Holds 12oz of your favorite beverage.' },
      'SKU-004': { id: 'SKU-004', name: 'Hat', price: 24.99, brand: 'Brand', category: 'Accessories', description: 'Adjustable cap with embroidered logo. One size fits most.' },
      'SKU-005': { id: 'SKU-005', name: 'Socks', price: 12.99, brand: 'Brand', category: 'Clothing', description: 'Comfortable cotton socks with our logo. Pack of 3.' },
      'SKU-006': { id: 'SKU-006', name: 'Sticker', price: 3.99, brand: 'Brand', category: 'Accessories', description: 'Waterproof vinyl sticker. Perfect for laptops, water bottles, or skateboards.' }
    };

    function loadProduct() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('id');
      const product = products[productId];

      if (product) {
        document.getElementById('product-details').innerHTML = `
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: start;">
            <div>
              <img src="https://via.placeholder.com/400x300/cccccc/000000?text=${product.name}" alt="${product.name}" class="product-image" style="height: 400px; object-fit: cover;">
            </div>
            <div>
              <h1>${product.name}</h1>
              <p class="price" style="font-size: 2rem; margin: 1rem 0;">$${product.price}</p>
              <p style="margin-bottom: 2rem;">${product.description}</p>
              <p><strong>Brand:</strong> ${product.brand}</p>
              <p><strong>Category:</strong> ${product.category}</p>
              <div style="display: flex; gap: 1rem; align-items: center; margin-top: 2rem;">
                <label for="quantity">Quantity:</label>
                <input type="number" id="quantity" value="1" min="1" style="width: 80px;">
              </div>
              <button id="add-to-cart-btn" class="btn btn-primary" style="margin-top: 1rem;">Add to Cart</button>
            </div>
          </div>
        `;

        // Add event listener after creating the button
        setTimeout(() => {
          const addButton = document.getElementById('add-to-cart-btn');
          if (addButton) {
            addButton.addEventListener('click', () => {
              const quantity = parseInt(document.getElementById('quantity').value);
              addToCart({ ...product, quantity });
              fireAddToCart(product, quantity);
              alert('Added to cart!');
            });
          }
        }, 100);

        // Fire product viewed event
        if (typeof fireProductViewed === 'function') {
          fireProductViewed(product);
        }
      } else {
        document.getElementById('product-details').innerHTML = `<h1>Product not found</h1><p>Product ID: ${productId || 'none'}</p>`;
      }
    }

    // Load product immediately
    loadProduct();

    // Fire page event when analytics is ready
    if (typeof analytics !== 'undefined') {
      analytics.ready(function() {
        if (typeof firePage === 'function') {
          firePage('pdp');
        }
      });
    }
  </script>
</body>
</html>
